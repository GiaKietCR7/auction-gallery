<%- include('partials/head', { title: 'Gallery' }) %>

<!-- HERO (English banner) -->
<section class="grid md:grid-cols-2 gap-8 items-center mb-10">
  <div>
    <h1 class="font-serif text-4xl md:text-5xl leading-tight mb-4">
      Discover & bid on curated works
    </h1>
    <p class="text-ink/70 mb-6">
      We showcase quality, sourced pieces and ensure a safe, transparent buying experience.
    </p>
    <div class="flex gap-3">
      <% const isAdmin = currentUser && String(currentUser.role || '').toLowerCase() === 'admin'; %>
      <% if (isAdmin) { %>
        <a href="/admin/upload" class="bg-ink text-white px-5 py-2 rounded-full text-[14px]">
          Upload artwork
        </a>
      <% } else { %>
        <a href="<%= currentUser ? '/contact' : '/login' %>" class="bg-ink text-white px-5 py-2 rounded-full text-[14px]">
          <%= currentUser ? 'Contact us' : 'Sign in to upload' %>
        </a>
      <% } %>
      <a href="/about" class="border px-5 py-2 rounded-full text-[14px]">Learn more</a>
    </div>
  </div>

  <!-- Right visual: hero image pulled from Supabase Storage (bucket 'images') -->
  <div class="rounded-2xl overflow-hidden h-64 md:h-72 relative">
    <img
      id="heroImg"
      src="<%= getImageUrl('banners/hero.jpg') %>"
      alt="Curated art gallery interior"
      class="w-full h-full object-cover"
      loading="eager"
      fetchpriority="high"
      onerror="this.style.display='none'; document.getElementById('heroFallback').style.display='block';"
    />
    <!-- Fallback if the image is missing -->
    <div id="heroFallback" class="hidden absolute inset-0 bg-mist"></div>
  </div>
</section>

<!-- Top bar: title + search -->
<div class="flex items-center justify-between mb-6">
  <h2 class="font-serif text-3xl">Gallery</h2>
  <form method="get" action="/" class="flex items-center gap-2">
    <input
      type="text"
      name="q"
      value="<%= q || '' %>"
      placeholder="Search artworks..."
      class="border rounded-full px-4 py-2 text-[14px]" />
    <button class="border px-4 py-2 rounded-full text-[14px]">Search</button>
  </form>
</div>

<!-- Items grid -->
<% if (!items.length) { %>
  <div class="text-ink/60">No items yet.</div>
<% } %>

<div class="grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
  <% items.forEach(it => { %>
    <a href="/item/<%= it.id %>" class="block border rounded-2xl overflow-hidden hover:shadow-hover transition">
      <img src="<%= getImageUrl(it.image_path) %>" alt="<%= it.title %>" class="w-full h-48 object-cover" />
      <div class="p-4">
        <div class="font-medium line-clamp-1"><%= it.title %></div>
        <div class="text-ink/60 text-sm mt-1">
          Top: $<%= Number((it.topbid ?? it.start_price) ?? 0).toFixed(2) %>
        </div>
      </div>
    </a>
  <% }) %>
</div>

<!-- Pagination -->
<% if (pager.totalPages > 1) { %>
  <div class="mt-8 flex items-center justify-center gap-3">
    <% if (pager.hasPrev) { %>
      <a class="border px-3 py-1 rounded"
         href="/?page=<%= pager.prev %><%= pager.q? '&q='+encodeURIComponent(pager.q):'' %>">Prev</a>
    <% } %>
    <span>Page <%= pager.page %> / <%= pager.totalPages %></span>
    <% if (pager.hasNext) { %>
      <a class="border px-3 py-1 rounded"
         href="/?page=<%= pager.next %><%= pager.q? '&q='+encodeURIComponent(pager.q):'' %>">Next</a>
    <% } %>
  </div>
<% } %>

<%- include('partials/foot') %>
